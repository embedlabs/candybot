{"title":"Feint Games","scrolling":true,"loadflow":"var localUserLoaded, localUserReq;\nOF.GA.setAccount('UA-3107048-21', 'spotlight.android.openfeint.com');\n$.loadScript('dashboard/dashboard');\nif ((typeof jasmine !== \"undefined\" && jasmine !== null) && OF.isBrowser) {\n  $.loadCss('settings/spec');\n}\nlocalUserLoaded = localUserReq = null;\nOF.loadLocalUser = function() {\n  if (OF.user.isLoaded) {\n    return typeof localUserLoaded === \"function\" ? localUserLoaded() : void 0;\n  } else {\n    return localUserReq || (localUserReq = OF.api(\"/xp/users/me\", {\n      success: function(userData) {\n        OF.user = userData.user;\n        OF.user.isLoaded = true;\n        if (typeof localUserLoaded === \"function\") {\n          localUserLoaded();\n        }\n        return localUserLoaded = localUserReq = null;\n      }\n    }));\n  }\n};\nOF.localUserLoaded = function(callback) {\n  if (OF.user.isLoaded) {\n    return callback();\n  } else {\n    return localUserLoaded = callback;\n  }\n};","init":"OF.loadLocalUser();\n$('body').addClass('textured');\n$('.button').pretouch();\n\n// Menu handling functions\nif (!OF.menu) {\n  OF.menu = function(buttonName) {\n    if      (buttonName == 'home')      OF.menu.home();\n    else if (buttonName == 'settings')  OF.menu.settings();\n    else if (buttonName == 'exit')      OF.menu.exit();\n    else {\n      OF.log('Unknown menu button hit: '+ buttonName);\n    }\n  };\n  \n  OF.menu.home = function() {\n    if (OF.navigationStack[0].url.match(/dashboard\\/user/)) {\n      OF.goBack({root:true});\n    } else {\n      \n      // This is a bit of a hack for now...\n      OF.navigateToUrl(\"dashboard/user\", {\n        complete: function() {\n          OF.pages.unshift(OF.pages.pop());\n          OF.action('back', {root:true}, OF.contentLoaded);\n        }\n      });\n    }\n  };\n  \n  OF.menu.settings = function() {\n    OF.sendAction('openSettings');\n  };\n  \n  OF.menu.exit = function() {\n    OF.sendAction('dismiss');\n  };\n}\n\n// Base friends page functions\nif (!OF.friendsList) {\n  OF.friendsList = {\n    init: function() {\n      jQuery.lazyLoad({\n        threshold: 0.5,  //percentage of the window height left to scroll that will trigger the next page\n        nextPageLoaded: function(page, data){ \n          if (page == 1) {\n            OF.friendsList.renderFriends(data);                 \n          } else {\n            OF.friendsList.addFriends(data);         \n          }\n        },\n        nextPageShouldLoad: function(page, callback) {\n          OF.api('/xp/friends', {\n            params: {\n              user_id:   OF.page.user.id,\n              page:      page,\n              page_size: 50\n            },\n            success: function(data) {\n              callback(data.users, data.users.length < 50)\n            },\n            failure: function() { callback([]); }\n          });\n        },\n        isEmpty: function() { OF.friendsList.renderFriends([]); },\n        isFinished: function() { jQuery(\"#loading\").hide(); }\n      });\n    },\n    \n    renderFriendItems: function(friends) {\n      var html = jQuery.map(friends, function(friend) {\n       return tmpl('user_tmpl', friend);\n      });\n      return html;\n    },\n    \n    renderFriends : function(friends) {    \n      var html = OF.friendsList.renderFriendItems(friends);\n      \n      if (html.length > 0) {\n        jQuery('#friends_list > ul').html(html.join('')).unhide();\n        jQuery(\"#friends_list .no_data\").hide();\n      } else {\n        jQuery('#friends_list > ul').hide();\n        jQuery(\"#friends_list .no_data\").unhide();      \n      }\n    },\n    \n    addFriends : function(friends) {    \n      var html = OF.friendsList.renderFriendItems(friends);\n      jQuery('#friends_list > ul').append(html.join(''));\n    }\n  };\n}\n\n// Go home on touching the logo area\n$('#home_button').touch(OF.menu.home);\nvar userID = OF.page.params.user_id || OF.user.id;\nvar gameTmpl = tmpl('game_tmpl');\n\nOF.page.games = [];\n\n// Touch handler for game cells\n$('.game_cell').touch(function() {\n  \n  // Start a user object local to this page\n  var isLocalUser = OF.page.params.user_id == OF.user.id;\n  var game = OF.page.games[parseInt($(this).attr('data-game_index'))].game;\n  \n  // 32334 is the spotlight production id 12953 is qa1's spotlight id\n  if (game.id == '32334' || !isLocalUser) {\n    OF.push('dashboard/game', { params: { game : game } });\n  } else {\n    if (game.platforms.indexOf('android') != -1) {\n      OF.push('dashboard/local_game', { params: { game : game } });\n    } else {\n      alert(\"The developer of this game has not yet setup all the information for this screen\");\n    }\n  }\n});\n\n$.lazyLoad({\n  nextPageLoaded: function(page, data) {\n    var sectionTitle =\n      (OF.page.params.user_id == OF.user.id)\n        ? \"Your Games\" \n        : OF.page.params.user_name + \"'s Games\";\n    $('.section_title').text(sectionTitle);\n    \n    var html = [];\n    if (data.games.length > 0) {\n      U.each(data.games, function(gameObj, i) {\n        gameObj.game.index = OF.page.games.length + i;\n        html.push(gameTmpl(gameObj.game));\n      });\n      $('#game_list').show().append(html.join(''));\n    } else if ($('#game_list li').length === 0) {\n      $('#game_list').append($('#no_games').html()).unhide();\n    }\n    \n    OF.page.games = OF.page.games.concat(data.games);\n  },\n  nextPageShouldLoad: function(page, callback) {\n    OF.api.request('/xp/users/'+ userID +'/games', {\n      params: { page: page },\n      loader: 'li.loading',\n      success: function(data) {\n        callback(data, data.games.length < 25);\n      }\n    });\n  }\n});","resume":null,"appear":"$('#header .title').html(OF.page.title);","disappear":null,"exit":null,"html":"<div id='dashboard'>\n  <div id='header'>\n    <span class='loading'>\n      <span class='spinner'></span>\n    </span>\n    <div class='title' id='home_button'></div>\n  </div>\n            <script type=\"text/plain\" id=\"game_tmpl\">\n              <% var style = null; %>\n  <% if (android_icon_url) { style = \"background-image: url(\" + android_icon_url + \")\"; } %>\n  \n  <li class=\"game_cell one_line\" data-game_index=\"<%= index %>\">\n    <div class=\"icon\" style=\"<%= style %>\"></div>\n    <div class=\"title\"><%= name %></div>\n  </li>\n            </script>\n            <script type=\"text/plain\" id=\"no_games\">\n              <li class=\"no_data\">This user doesn't have any Android compatible Feint Games.</li>\n            </script>\n  <div id='games'>\n    <ul class='cells'>\n      <li class='section_title'></li>\n    </ul>\n    <ul class='cells' id='game_list'>\n      <li class='loading'>\n        <div class='spinner'></div>\n      </li>\n    </ul>\n  </div>\n</div>\n"}