{"title":"Email","scrolling":true,"loadflow":null,"init":"$('body').addClass('textured');\n$('#subheader').text(OF.page.title);\nif (OF.user.email) {\n  $('.current_info').removeClass('hidden');\n  $('.current_info .value').text(OF.user.email);\n}\n\n$('#change_email_form').submit(function() {\n  if ($(this).isLoading()) return false;\n      \n  if ($('#change_email_form').isFormFilled('Enter your current password and your new email address to continue.')) {\n    $(this).isLoading(true);\n    var newEmail = $('#user_http_basic_credential_attributes_email').val();\n    \n    OF.api.request('/xp/users/'+ OF.user.id, {\n      method: 'PUT',\n      loader: '#submit',\n      params: {\n        password: $('#password').val(),\n        user: {\n          http_basic_credential_attributes: {\n            email: newEmail\n          }\n        }\n      },\n      success: function() {\n        OF.goBack();\n        OF.alert('Success', 'You have changed your email to: '+ newEmail);\n      },\n      failure: function(data) {\n        if (data.exception) {\n          if (data.exception['class'] == 'PlayerNotAuthenticated') {\n            OF.alert('Error', 'Your current password was not correct.');\n          } else {\n            return false;\n          }\n        } else {\n          return false;\n        }\n      },\n      complete: function() {\n        $('#change_email_form').isLoading(false);\n      }\n    });\n  }    \n  \n  return false;\n});\n\n$('#submit').touch(function() {\n  $('#change_email_form').submit();\n});","resume":null,"appear":null,"disappear":null,"exit":null,"html":"<div id='settings'>\n  <div id='header'>\n    Settings\n    <span class='loading'>\n      <span class='spinner'></span>\n    </span>\n  </div>\n  <div id='subheader'></div>\n  <div class='current_info'>\n    <div class='label'>Current Email Address</div>\n    <div class='value'></div>\n  </div>\n  <form id='change_email_form'>\n    <div class='input_field'>\n      <label>Current Password</label>\n      <input id='password' name='password' type='password'>\n    </div>\n    <div class='input_field'>\n      <label>New Email Address</label>\n      <input id='user_http_basic_credential_attributes_email' name='user[http_basic_credential_attributes][email]' type='text'>\n    </div>\n    <div class='button' id='submit'>Okay</div>\n  </form>\n</div>\n"}