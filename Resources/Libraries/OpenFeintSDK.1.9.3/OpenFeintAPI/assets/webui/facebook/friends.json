{"title":"Feint Friends","scrolling":true,"loadflow":"","init":"\n$('body').addClass('textured');$('.button').pretouch();if(!OF.menu){OF.menu=function(buttonName){if(buttonName=='home')OF.menu.home();else if(buttonName=='settings')OF.menu.settings();else if(buttonName=='exit')OF.menu.exit();else{OF.log('Unknown menu button hit: '+buttonName);}};OF.menu.home=function(){if(OF.navigationStack[0].url.match(/dashboard\\/user/)){OF.goBack({root:true});}else{OF.navigateToUrl(\"dashboard/user\",{complete:function(){OF.navigationStack=[OF.page];OF.sendAction('back',{root:true});}});}};OF.menu.settings=function(){OF.sendAction('openSettings');};OF.menu.exit=function(){OF.sendAction('dismiss');};}\nif(!OF.friendsList){OF.friendsList={init:function(){$.lazyLoad({threshold:0.5,nextPageLoaded:function(page,data){if(page==1){OF.friendsList.renderFriends(data);}else{OF.friendsList.addFriends(data);}},nextPageShouldLoad:function(page,callback){OF.api.request('/xp/friends',{params:{user_id:OF.page.user.id,page:page,page_size:50},success:function(data){callback(data.users,data.users.length<50)},failure:function(){callback([]);}});},isEmpty:function(){OF.friendsList.renderFriends([]);},isFinished:function(){$(\"#loading\").hide();}});},renderFriendItems:function(friends){var html=$.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){$('#friends_list > ul').html(html.join('')).unhide();$(\"#friends_list .no_data\").hide();}else{$('#friends_list > ul').hide();$(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);$('#friends_list > ul').append(html.join(''));}};}\n$('#home_button').touch(OF.menu.home);var friendables=[];var users_count=0;var PENDING_LABEL='Pending...';$('.add_friend_button').touch(function(){this_id=this.id;$(this).text(PENDING_LABEL);$(this).addClass('disabled');OF.api.request('/xp/friend_requests',{background:true,method:'POST',params:{friend_id:this_id},loader:'#loading .loading',success:function(data){var index_to_remove=friendables.indexOf(Number(this_id));if(index_to_remove!=-1)friendables.splice(index_to_remove,1);if((friendables.length<1)&&(users_count>1)){$('#add_all_friends_button').addClass('disabled').text(PENDING_LABEL);}}});});$('#add_all_friends_button').touch(function(){$(this).addClass('disabled');if($(this).text!=PENDING_LABEL){$(this).text('Adding...')}\n$('.add_friend_button').addClass('disabled').text(PENDING_LABEL)\nOF.api.request('/xp/facebook/add_friends',{method:'POST',params:{friend_ids:friendables},loader:'#loading .loading',success:function(data){$('#find_friends').addClass('hidden');$('#all_requests_sent').removeClass('hidden');}});});OF.api.request('/xp/facebook/list',{loader:'#loading .loading',success:function(data){var userTmpl=tmpl('a_user');var html=[];users_count=data.users.length;if(users_count>0){$.each(data.users,function(){html.push(userTmpl(this));friendables.push(this.id);});$('ul#friends_list').append(html.join(\"\"));$('#fb_friend_count_bar').unhide();if(users_count!=1){$('#facebook_friends_count').html(users_count+' Friends Using Feint');}else{$('#facebook_friends_count').html('1 Friend Using Feint');}\nif(users_count<2){$('#add_all_friends_button').hide();}}else{$('#no_friends_found').unhide();}},failure:function(data,status){}});","resume":"","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n          <script type=\"text/plain\" id=\"a_user\">\n            <% var style = \"\"; %>\n<% if(profile_picture_url){ style = \"background-image: url(\" + profile_picture_url + \")\" } %>\n\n<li class=\"user\">\n  <div id=\"<%= id %>\" class=\"button add_friend_button\">+ Add</div>\n  <div class=\"image avatar\" style=\"<%= style %>\">\n    <div class=\"overlay\"></div>\n  </div>\n  <div class=\"title feint_name\"><%= feint_name %></div>\n  <div class=\"facebook_name\"><%= facebook_name %></div>\n</li>\n          </script>\n<div id='friends'>\n<section id='find_friends'>\n<h3 class='section_title'>Facebook Friends</h3>\n<div class='hidden' id='fb_friend_count_bar'>\n<div class='cell'>\n<div class='button' id='add_all_friends_button'>Add All</div>\n<div class='icon'></div>\n<div class='content'>\n<div id='facebook_friends_count'>0</div>\n</div>\n</div>\n</div>\n<ul class='cells' id='friends_list'></ul>\n<div class='hidden' id='no_friends_found'>\n<div class='cell'>\nWe couldn't find any Feint accounts associated with your Facebook friends.  Try searching by their Feint username instead.\n</div>\n<div class='cell one_line' data-href='dashboard/user_search'>\n<div class='icon'></div>\n<div class='title'>Search by Feint Name</div>\n</div>\n</div>\n</section>\n<section class='hidden' id='all_requests_sent'>\n<h3 class='section_title'>Facebook Friends</h3>\n<div id='all_requests_sent'>\n<div class='cell'>Your friend requests have been sent!</div>\n</div>\n</section>\n<ul class='cells' id='loading'>\n<li class='loading'>\n<div class='spinner'></div>\n</li>\n</ul>\n</div>\n\n</div>\n"}