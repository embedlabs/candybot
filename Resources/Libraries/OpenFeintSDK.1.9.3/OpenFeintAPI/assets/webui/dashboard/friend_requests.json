{"title":"Feint Friends","scrolling":true,"loadflow":"\nOF.GA.setAccount('UA-3107048-21','spotlight.android.openfeint.com');","init":"\n$('body').addClass('textured');$('.button').pretouch();if(!OF.menu){OF.menu=function(buttonName){if(buttonName=='home')OF.menu.home();else if(buttonName=='settings')OF.menu.settings();else if(buttonName=='exit')OF.menu.exit();else{OF.log('Unknown menu button hit: '+buttonName);}};OF.menu.home=function(){if(OF.navigationStack[0].url.match(/dashboard\\/user/)){OF.goBack({root:true});}else{OF.navigateToUrl(\"dashboard/user\",{complete:function(){OF.pages.unshift(OF.pages.pop());OF.action('back',{root:true},OF.contentLoaded);}});}};OF.menu.settings=function(){OF.sendAction('openSettings');};OF.menu.exit=function(){OF.sendAction('dismiss');};}\nif(!OF.friendsList){OF.friendsList={init:function(){jQuery.lazyLoad({threshold:0.5,nextPageLoaded:function(page,data){if(page==1){OF.friendsList.renderFriends(data);}else{OF.friendsList.addFriends(data);}},nextPageShouldLoad:function(page,callback){OF.api('/xp/friends',{params:{user_id:OF.page.user.id,page:page,page_size:50},success:function(data){callback(data.users,data.users.length<50)},failure:function(){callback([]);}});},isEmpty:function(){OF.friendsList.renderFriends([]);},isFinished:function(){jQuery(\"#loading\").hide();}});},renderFriendItems:function(friends){var html=jQuery.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){jQuery('#friends_list > ul').html(html.join('')).unhide();jQuery(\"#friends_list .no_data\").hide();}else{jQuery('#friends_list > ul').hide();jQuery(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);jQuery('#friends_list > ul').append(html.join(''));}};}\n$('#home_button').touch(OF.menu.home);OF.api.request('/xp/friend_requests',{loader:'#requests .loading',success:function(data){var requestTmpl=tmpl('request_tmpl');var html=[];$.each(data.friend_requests,function(){html.push(requestTmpl(this));});$('#requests ul').append(html.join(''));if(data.friend_requests.length>1){$('#buttons_for_all').unhide();}\n$('.button').touch(function(){var button=$(this);var action=button.attr('data-requestaction');var request_id=button.attr('data-requestid');var params={};if(request_id=='all'){params.all=true;}else{params.id=request_id;OF.shouldRefreshPage=true;}\nOF.api.request('/xp/friend_requests/'+action,{method:'POST',params:params,on404:function(data){button.parents('li.friend_request').fadeOut();if(data.friend_requests.total<=0){OF.shouldRefreshPage=false;OF.goBack({complete:function(previousPage){$('#requests').fadeOut();previousPage.reload()}});}\nreturn true;},success:function(data){if(params.all||data.friend_requests.total<=0){OF.shouldRefreshPage=true;OF.goBack({complete:function(previousPage){$('#requests').fadeOut();previousPage.reload()}});}else{button.parents('li.friend_request').fadeOut();}}});});}});","resume":"","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n          <script type=\"text/plain\" id=\"request_tmpl\">\n            <%\n  var bgstyle = '';\n  if (friend_request.user.profile_picture_url) {\n    bgstyle = \"background-image: url(\"+ friend_request.user.profile_picture_url +\")\";\n  }\n%>\n<li class=\"friend_request\">\n  <div class=\"image avatar\" style=\"<%= bgstyle %>\">\n    <div class=\"overlay\"></div>\n  </div>\n  <div class=\"title user_name\"><%= friend_request.user.name %></div>\n  <div class=\"buttons\">\n    <div class=\"button accept\" data-requestaction=\"accept\" data-requestid=\"<%= friend_request.id %>\">Accept</div>\n    <div class=\"button ignore\" data-requestaction=\"ignore\" data-requestid=\"<%= friend_request.id %>\">Ignore</div>\n  </div>\n  <div class=\"reset\"></div>\n</li>\n          </script>\n<div id='friends'>\n<div id='requests'>\n<h3 class='section_title'>Friend Requests</h3>\n<ul class='cells'>\n<li class='loading'>\n<div class='spinner'></div>\n</li>\n</ul>\n</div>\n<div class='hidden' id='buttons_for_all'>\n<div class='button' data-requestaction='accept' data-requestid='all' id='accept_all'>Accept All</div>\n<div class='button' data-requestaction='ignore' data-requestid='all' id='ignore_all'>Ignore All</div>\n</div>\n</div>\n\n</div>\n"}