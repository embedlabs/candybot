{"title":"User Profile","scrolling":true,"loadflow":"\nOF.GA.setAccount('UA-3107048-21','spotlight.android.openfeint.com');","init":"\n$('body').addClass('textured');$('.button').pretouch();if(!OF.menu){OF.menu=function(buttonName){if(buttonName=='home')OF.menu.home();else if(buttonName=='settings')OF.menu.settings();else if(buttonName=='exit')OF.menu.exit();else{OF.log('Unknown menu button hit: '+buttonName);}};OF.menu.home=function(){if(OF.navigationStack[0].url.match(/dashboard\\/user/)){OF.goBack({root:true});}else{OF.navigateToUrl(\"dashboard/user\",{complete:function(){OF.pages.unshift(OF.pages.pop());OF.action('back',{root:true},OF.contentLoaded);}});}};OF.menu.settings=function(){OF.sendAction('openSettings');};OF.menu.exit=function(){OF.sendAction('dismiss');};}\nif(!OF.friendsList){OF.friendsList={init:function(){jQuery.lazyLoad({threshold:0.5,nextPageLoaded:function(page,data){if(page==1){OF.friendsList.renderFriends(data);}else{OF.friendsList.addFriends(data);}},nextPageShouldLoad:function(page,callback){OF.api('/xp/friends',{params:{user_id:OF.page.user.id,page:page,page_size:50},success:function(data){callback(data.users,data.users.length<50)},failure:function(){callback([]);}});},isEmpty:function(){OF.friendsList.renderFriends([]);},isFinished:function(){jQuery(\"#loading\").hide();}});},renderFriendItems:function(friends){var html=jQuery.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){jQuery('#friends_list > ul').html(html.join('')).unhide();jQuery(\"#friends_list .no_data\").hide();}else{jQuery('#friends_list > ul').hide();jQuery(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);jQuery('#friends_list > ul').append(html.join(''));}};}\n$('#home_button').touch(OF.menu.home);OF.page.user=OF.page.params.user||{id:OF.page.params.user_id||OF.user.id};var isLocalUser=OF.page.user.id==OF.user.id;if(isLocalUser){OF.page.onProfilePictureChanged=function(url){$('.avatar').css('background-image','url('+url+')');}}\nOF.page.setFriendsSubtitle=function(count,label){var val=count+' '+label+(count>1||count==0?'s':'')\n$('li#friends .subtitle').text(val).unhide();}\nOF.page.update=function(){$('.game_name').html('Playing '+OF.game.name);$('.user_name').html(OF.page.user.name);$('.user_score').html(OF.page.user.gamer_score);$('.user_score').removeClass('hidden');var gamesString=OF.page.user.games_count==1?'game':'games';$('li#games .subtitle').text(OF.page.user.games_count+' '+gamesString).hide().fadeIn();if(OF.page.user.profile_picture_url){var thisPage=OF.page;setTimeout(function(){if(OF.page==thisPage){$('.avatar').css('background-image','url('+OF.page.user.profile_picture_url+')');}},1000);}else{$('.avatar').css('background-image',null);}\nOF.page.setFriendsSubtitle(OF.page.user.friendship_count||0,\"Friend\");}\nif(isLocalUser){if($('#header_replacement').length>0){$('#header').remove();$('#header_replacement').attr('id','header');}\n$('.playing').removeClass('hidden');$('.avatar').touch(function(){OF.sendAction('profilePicture');});if(OF.page.params.spotlight){$('#leaderboards').hide();$('#achievements').hide();}else{OF.api('/xp/games/'+OF.game.id,{background:true,success:function(data){if(data.game.leaderboards.total<1){$('#leaderboards').hide();}\nif(data.game.achievements.total<1){$('#achievements').hide();}\nif(!data.game.approved_for_current_platform){$('#unapproved').removeClass('hidden').hide().slideDown();}}});}}else{$('#leaderboards').hide();$('#achievements').hide();$('#header_replacement').remove();$('#user_profile').addClass('other_user');}\n$('#add_friend').touch(function(){OF.api('/xp/friend_requests',{background:true,method:'POST',params:{friend_id:OF.page.user.id}});$('#add_friend').hide();$('#pending_friend').removeClass('hidden');});$('#remove_friend').touch(function(){OF.api('/xp/friends/'+OF.page.user.id,{background:true,method:'DELETE',});$('#remove_friend').hide();$('#add_friend').removeClass('hidden');var friends=[];$.each(OF.user.friends,function(){if(this.id!=OF.page.user.id){friends.push(this);}});OF.user.friends=friends;});$('#achievements').touch(function(){OF.push('dashboard/achievements',{params:{user:OF.page.user}});});$('#games').touch(function(){OF.push('dashboard/games',{params:{user_id:OF.page.user.id,user_name:OF.page.user.name}});});$('#friends').touch(function(){if(isLocalUser){OF.navigateToUrl('dashboard/me/friends');}else{OF.navigateToUrl('dashboard/friends',{params:{user:OF.page.user}});}});if(!isLocalUser){OF.api('/xp/friends/status',{background:true,method:'GET',params:{id:OF.page.user.id},success:function(data){var status=data.friendship.status;if(status=='friends'){$('#remove_friend').unhide()}else if(status=='unrelated'){$('#add_friend').unhide();}else{$('#pending_friend').unhide();}},})}\nOF.api('/xp/users/'+OF.page.user.id,{complete:function(){$('#info_cell .loading').hide();},success:function(data){OF.page.user=data.user;if(isLocalUser){OF.user=OF.page.user;}\nOF.page.update();OF.api('/xp/users/'+OF.page.user.id+'/games/'+OF.game.id+'/achievements',{background:true,failure:$.noop,success:function(data){var total=data.achievements.length;var unlocked=0;$.each(data.achievements,function(){if(this.achievement.is_unlocked)unlocked++;});$('li#achievements .subtitle').text(unlocked+' out of '+total+' unlocked').hide().fadeIn();}});if(isLocalUser){if(OF.user.received_friend_requests_pending_count>0){OF.page.setFriendsSubtitle(OF.user.received_friend_requests_pending_count,\"Friend Request\");}}}});","resume":"\nOF.page.update();","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n<div id='user_profile'>\n<div id='header_replacement'>\n<div id='home_button'></div>\n<span class='loading'>\n<span class='spinner'></span>\n<span class='text'>Loading...</span>\n</span>\n</div>\n<div class='user clearfix' id='info_cell'>\n<div class='loading'>\n<div class='spinner light'></div>\n</div>\n<div class='avatar'>\n<div class='overlay'></div>\n</div>\n<div class='user_name'>&nbsp;</div>\n<div class='playing hidden'>\n<span class='game_name'></span>\n</div>\n<div class='user_score hidden'></div>\n<div class='button hidden' id='add_friend'>Add Friend</div>\n<div class='button hidden' id='remove_friend'>Remove Friend</div>\n<div class='button disabled hidden' id='pending_friend'>Pending Friend</div>\n</div>\n<div class='hidden' id='unapproved'>\nThis game is under development.  Some Feint Dashboard features may not\nbe functional.\n</div>\n<ul class='cells'>\n<li data-href='dashboard/leaderboards' id='leaderboards'>\n<div class='icon'></div>\n<div class='title'>Leaderboards</div>\n<div class='subtitle'>See your scores</div>\n</li>\n<li id='achievements'>\n<div class='icon'></div>\n<div class='title'>Achievements</div>\n<div class='subtitle'></div>\n</li>\n<li id='games'>\n<div class='icon'></div>\n<div class='title'>Games</div>\n<div class='subtitle'></div>\n</li>\n<li id='friends'>\n<div class='icon'></div>\n<div class='title'>Friends</div>\n<div class='subtitle'></div>\n</li>\n</ul>\n</div>\n\n</div>\n"}