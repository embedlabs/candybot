{"title":"Leaderboards","scrolling":true,"loadflow":"\nOF.GA.setAccount('UA-3107048-21','spotlight.android.openfeint.com');","init":"\n$('body').addClass('textured');$('.button').pretouch();if(!OF.menu){OF.menu=function(buttonName){if(buttonName=='home')OF.menu.home();else if(buttonName=='settings')OF.menu.settings();else if(buttonName=='exit')OF.menu.exit();else{OF.log('Unknown menu button hit: '+buttonName);}};OF.menu.home=function(){if(OF.navigationStack[0].url.match(/dashboard\\/user/)){OF.goBack({root:true});}else{OF.navigateToUrl(\"dashboard/user\",{complete:function(){OF.pages.unshift(OF.pages.pop());OF.action('back',{root:true},OF.contentLoaded);}});}};OF.menu.settings=function(){OF.sendAction('openSettings');};OF.menu.exit=function(){OF.sendAction('dismiss');};}\nif(!OF.friendsList){OF.friendsList={init:function(){jQuery.lazyLoad({threshold:0.5,nextPageLoaded:function(page,data){if(page==1){OF.friendsList.renderFriends(data);}else{OF.friendsList.addFriends(data);}},nextPageShouldLoad:function(page,callback){OF.api('/xp/friends',{params:{user_id:OF.page.user.id,page:page,page_size:50},success:function(data){callback(data.users,data.users.length<50)},failure:function(){callback([]);}});},isEmpty:function(){OF.friendsList.renderFriends([]);},isFinished:function(){jQuery(\"#loading\").hide();}});},renderFriendItems:function(friends){var html=jQuery.map(friends,function(friend){return tmpl('user_tmpl',friend);});return html;},renderFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);if(html.length>0){jQuery('#friends_list > ul').html(html.join('')).unhide();jQuery(\"#friends_list .no_data\").hide();}else{jQuery('#friends_list > ul').hide();jQuery(\"#friends_list .no_data\").unhide();}},addFriends:function(friends){var html=OF.friendsList.renderFriendItems(friends);jQuery('#friends_list > ul').append(html.join(''));}};}\n$('#home_button').touch(OF.menu.home);var userID=OF.page.params.user_id||OF.user.id;var gameID=OF.page.params.game_id||OF.game.id;var leaderboardID=OF.page.params.leaderboard_id;OF.page.params.show_blobs=(gameID===OF.game.id);var name=OF.page.params.leaderboard_name;var scoreTmpl=tmpl('score_tmpl');var everyoneRequest=null;var myScoreRequest=null;var friendScoreRequest=null;if(!name){OF.api.request('/xp/games/'+gameID+'/leaderboards/'+leaderboardID,{method:'GET',success:function(data){if(data.leaderboard.name.length>0){OF.forceSetTitle(data.leaderboard.name);}}});}else{OF.page.title=name}\nvar load=function(interval,tab){if(everyoneRequest)everyoneRequest.cancel();if(myScoreRequest)myScoreRequest.cancel();if(friendScoreRequest)friendScoreRequest.cancel();$(\"section.scores\").addClass(\"hidden\");$(\"section.scores ul\").remove();$(\"#no_data\").addClass(\"hidden\").hide();$(\"#time_frame li\").removeClass(\"active\");$(tab).addClass(\"active\");$(\".loading\").show();var rankScores=function(scores){var rank=0;$.each(scores,function(){if(!this.high_score.rank)this.high_score.rank=++rank;});}\nvar renderScores=function(scoresObject){$.each(scoresObject,function(section,scores){if(scores.length==0){return;}\nvar html='';$.each(scores,function(){if(this.high_score.display_text&&$.trim(this.high_score.display_text).length>0){this.high_score.display_score=this.high_score.display_text;}else{this.high_score.display_score=this.high_score.score;}\nhtml+=scoreTmpl(this.high_score);});var ul=$(\"<ul class='cells scores'>\").html(html);$('#'+section).append(ul).unhide();});}\nvar checkForData=function(){allComplete=everyoneRequest.isComplete&&myScoreRequest.isComplete&&friendScoreRequest.isComplete;if(allComplete){$(\".loading\").hide();noData=true;$.each(scores,function(section,highScores){if(highScores.length>0){noData=false;}});if(noData){$(\"#no_data\").unhide();}else{renderScores(scores);}}}\nvar baseParams=function(){interval>0?{interval:interval}:{};}\nvar scores={everyone:null,your_friends:null,you:null,};everyoneRequest=OF.api.request('/xp/games/'+gameID+'/leaderboards/'+leaderboardID+'/high_scores',{success:function(data){rankScores(data.high_scores);scores.everyone=data.high_scores;},complete:checkForData,params:baseParams(),});myScoreRequest=OF.api.request('/xp/users/'+userID+'/games/'+gameID+'/leaderboards/'+leaderboardID+'/current_score',{success:function(data){scores.you=[data];},failure:function(){scores.you=[];},complete:checkForData,params:baseParams(),});friendScoreRequest=OF.api.request('/xp/games/'+gameID+'/leaderboards/'+leaderboardID+'/high_scores',{success:function(data){rankScores(data.high_scores);if(data.high_scores.length==1&&data.high_scores[0].high_score.user.id==userID){scores.your_friends=[];}else{scores.your_friends=data.high_scores;}},complete:checkForData,params:$.extend(baseParams(),{friends_leaderboard:true}),});}\n$(\".high_score_blob_icon\").touch(function(event){OF.sendAction('downloadBlob',{'score':$(this).attr('data-high_score')});})\n$(\"#time_frame li\").touch(function(){if($(this).hasClass(\"active\")){return;}\nload($(this).attr(\"data-interval\"),$(this))});load(0,$(\"#time_frame li\").first());","resume":"","appear":"\n$('#header .title').html(OF.page.title);","html":"<div id='dashboard'>\n<div id='header'>\n<span class='loading'>\n<span class='spinner'></span>\n</span>\n<div class='title' id='home_button'></div>\n</div>\n          <script type=\"text/plain\" id=\"score_tmpl\">\n            <li class=\"high_score\" data-href=\"dashboard/user?user_id=<%= user.id %>\"<% if((typeof blob_url != \"undefined\") && OF.page.params.show_blobs) {%> style=\"margin-right:70px\"<% } %>>\n  <div class=\"icon\" <% if (user.profile_picture_url) { %> style=\"background-image: url(<%= user.profile_picture_url %>)\" <% } %>>\n    <div class=\"overlay\"></div>\n  </div>\n  <div class=\"title\">\n    <% if(typeof rank != \"undefined\") { %>\n    <span class=\"rank\"><%= rank %></span>\n    <% } %>\n    <span class=\"user_name truncate\"><%= user.name %></span>\n  </div>\n  <div class=\"subtitle\"><%= display_score %></div>\n</li>\n<% if((typeof blob_url != \"undefined\") && OF.page.params.show_blobs) { %>\n  <li class=\"icon high_score_blob_icon\" data-high_score='<%= JSON.stringify({high_score: obj}) %>'>\n    <div class=\"button\">\n      <div class=\"icon\"/>\n    </div>\n  </li>\n<% } %>\n          </script>\n<div id='leaderboard'>\n<div class='cell no_data hidden' id='no_data'>\n<p>\nThere are no scores yet for this leaderboard.\n</p>\n</div>\n<section class='scores hidden' id='you'>\n<h3 class='section_title'>You</h3>\n</section>\n<section class='scores hidden' id='your_friends'>\n<h3 class='section_title'>Your Friends</h3>\n</section>\n<section class='scores hidden' id='everyone'>\n<h3 class='section_title'>Everyone</h3>\n</section>\n<div class='cell loading'>\n<div class='spinner'></div>\n</div>\n</div>\n\n</div>\n"}